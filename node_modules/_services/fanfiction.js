var Promise = require('bluebird');
var request = Promise.promisifyAll(require('request'));
var readDir = Promise.promisify(require('fs').readdir);
var path = require('path');
var _ = require('underscore');
var url = require('url');
var t = require('_i18n');

//dynamically compute acceptedDomains by looking which adapters we have
var acceptedDomains
readDir(path.resolve(process.cwd(), 'node_modules/_services/adapters')).then(function(adapters) {
    acceptedDomains = adapters.map(function(adapterName) {
        return adapterName.replace('.adapter.js', '');
    });
}).catch(function(e) {
    throw e;
});

module.exports = {
    check: function(_url) {
        return new Promise(function(resolve, reject) {
            if (!_.contains(acceptedDomains, url.parse(_url).host)) throw new Error(t.gettext('Unsupported domain'));
            console.log('Ok domain');
            resolve('ok domain');
        });
    },
    checkAndRetrieve: function(_url) {
    },
    getAcceptedDomains: function() {
        return acceptedDomains;
    }
}
