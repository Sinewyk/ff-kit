var Promise = require('bluebird');
var request = Promise.promisifyAll(require('request'));
var url = require('url');
var t = require('_i18n');

//load adapters ...
var adapters = {
    'www.fanfiction.net': require('./adapters/www.fanfiction.net.adapter')
};

module.exports = {
    check: function(_url) {
        return new Promise(function(resolve, reject) {
            var domain = url.parse(_url).host;
            if (!adapters[domain]) throw new Error(t.gettext('Unsupported domain'));
            return request.getAsync(_url)
            .get("1")
            .then(adapters[domain].process)
            .then(resolve)
            .catch(function(e) {
                throw new Error(t.gettext('Failed checking the story'));
            });
        });
    },
    checkAndRetrieve: function(_url) {
    },
    getAcceptedDomains: function() {
        return acceptedDomains;
    }
}
